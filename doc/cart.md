```
朱雀桥边野草花，乌衣巷口夕阳斜。

旧时王谢堂前燕，飞入寻常百姓家。
——《乌衣巷》 刘禹锡
``` 

#### 基本用例

![](https://user-gold-cdn.xitu.io/2020/7/29/173991c61c158f53?w=966&h=587&f=png&s=92573)

##### 和商品服务的关系：

1）查商品详情，如商品标题、图片、价格等

##### 和库存服务的关系：

1）查库存


#### 关键流程

##### 查看购物车 

![](https://user-gold-cdn.xitu.io/2020/7/29/173991e73e805291?w=709&h=635&f=png&s=33207)

关键点：

1）商品状态判断：上下架、预售

2）商品限购

3）库存紧张判断

##### 修改数量/商品规格

![](https://user-gold-cdn.xitu.io/2020/7/29/1739920243c6b7a6?w=619&h=422&f=png&s=20029)

关键点：

1）在购物车中口加减数量，不涉及库存扣减操作，仅判断当前库存是否满足购买数量

2）关于库存扣减

    2.1）类似唯品会、小红书、聚美优品这类做特卖、秒杀的平台，是加入购物车即扣库存，定期清空购物车，释放库存

    2.2）类似淘宝、京东，加入购物车并不回扣减库存，商品可以在购物车中长期存放
    
##### 容量

![](https://user-gold-cdn.xitu.io/2020/7/29/1739921bda130e1b?w=617&h=267&f=png&s=17181)




#### 存储

##### 基本数据模型

![](https://user-gold-cdn.xitu.io/2020/7/29/173992f6148c7102?w=288&h=306&f=png&s=16467)

channel_id用来标识不同的业务渠道，比如是A业务的购物车，还是B业务的购物车，如无需区分业务，则可以不用。

这是购物车最简单的数据模型

##### 存储方案

1. 基于redis
 
    使用Redis的Hash数据结构类型

![](https://user-gold-cdn.xitu.io/2020/7/29/173993386b89f7d3?w=623&h=322&f=png&s=23338)



2. 基于数据库
    
![](https://user-gold-cdn.xitu.io/2020/7/29/17399341744fcfbe?w=396&h=123&f=png&s=3386)



#### 对外接口

|  接口   | 说明  |
|  ----  | ----  |
| /cart/add  | 加入购物车 |
| /cart/get  | 获取购物车 |
| /cart/modify  | 修改商品数量/规格 |
| /cart/remove  | 删除商品/清除失效商品 |
| /cart/clear  | 清空购物车 |